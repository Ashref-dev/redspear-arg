<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>LAYER 05: MEMORY</title>
    <link rel="stylesheet" href="index.css" />
    <style>
      .memory-img {
        max-width: 80%;
        display: none;
        filter: grayscale(100%) contrast(150%) brightness(50%);
        border: 1px solid red;
      }
      .active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="cursor-dot" class="cursor-dot"></div>
    <div class="vignette"></div>
    <div class="scanlines"></div>
    <div class="noise" style="opacity: 0.15"></div>

    <h2 class="font-pixel glitch-text" data-text="MEMORY_FILE_CORRUPTED">
      MEMORY_FILE_CORRUPTED
    </h2>

    <div id="slideshow" style="margin-top: 50px">
      <canvas
        id="mem1"
        class="dither-canvas active"
        width="400"
        height="300"
      ></canvas>
    </div>

    <!-- Hidden Key Flash -->
    <div
      id="glitch-flash"
      style="
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 10rem;
        color: white;
        display: none;
        font-family: var(--font-pixel);
        z-index: 9999;
      "
    >
      E
    </div>

    <div style="margin-top: 50px">
      <p style="color: red; opacity: 0.6">I can't see her face anymore.</p>
      <a
        href="layer_06.html"
        class="hidden-link font-ui"
        style="font-size: 1.5rem"
        id="no-link"
        >[ CONTINUE ]</a
      >
    </div>

    <script src="dither.js"></script>
    <script src="hints.js"></script>
    <script src="audio.js"></script>
    <script>
      startLivingWired();
      document.addEventListener(
        'click',
        () => {
          if (window.audioCtx && audioCtx.state === 'suspended')
            audioCtx.resume();
          initAudio();
        },
        { once: true }
      );
      registerHint('no-link', 'glitch-hint');

      const ctx = document.getElementById('mem1').getContext('2d');

      function drawNoiseArt() {
        ctx.fillStyle = '#111';
        ctx.fillRect(0, 0, 400, 300);

        for (let i = 0; i < 50; i++) {
          ctx.fillStyle = `rgba(${
            Math.random() * 255
          }, 0, 0, ${Math.random()})`;
          ctx.fillRect(
            Math.random() * 400,
            Math.random() * 300,
            Math.random() * 50,
            Math.random() * 50
          );
        }

        const imgData = ctx.getImageData(0, 0, 400, 300);
        applyBayerDither(imgData, bayerMap);
        ctx.putImageData(imgData, 0, 0);

        // Random FLASH of "1998"
        if (Math.random() > 0.90) {
          flashKey();
        }
      }

      function flashKey() {
        const el = document.getElementById('glitch-flash');
        el.style.display = 'block';
        document.body.classList.add('invert-flash'); // Add heavy chaos
        setTimeout(() => {
          el.style.display = 'none';
          document.body.classList.remove('invert-flash');
        }, 100);
      }

      setInterval(drawNoiseArt, 1000);
    </script>
  </body>
</html>
