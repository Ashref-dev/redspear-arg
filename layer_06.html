<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>LAYER 06: CONNECTION</title>
    <link rel="stylesheet" href="index.css" />
    <style>
      #chat-box {
        width: 80%;
        height: 60vh;
        border: 1px solid var(--lain-blue);
        padding: 20px;
        overflow-y: auto;
        color: var(--lain-blue);
      }
      .msg {
        margin-bottom: 10px;
      }
      .user {
        color: var(--main-red);
      }
      .sys {
        color: #fff;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div id="cursor-dot" class="cursor-dot"></div>
    <div class="vignette"></div>
    <div class="scanlines"></div>
    <div class="noise" style="opacity: 0.1"></div>

    <div
      style="
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        height: 100vh;
      "
    >
      <div id="chat-box" class="font-pixel">
        <div class="msg sys">System: Connected to WIRED_CORE_SERVER</div>
        <div class="msg sys">System: ALICE_BACKUP_04 online.</div>
        <div class="msg sys">
          System: AUTHENTICATION REQUIRED. ENTER PASSPHRASE.
        </div>
      </div>

      <input
        type="text"
        id="chat-input"
        class="font-pixel"
        style="
          width: 80%;
          background: black;
          border: 1px solid var(--lain-blue);
          color: white;
          padding: 10px;
          margin-top: 20px;
        "
        placeholder="WHO_AM_I?"
      />

      <div style="margin-top: 20px">
        <a
          href="#"
          onclick="location.reload()"
          style="color: var(--lain-blue); text-decoration: none"
          class="font-ui"
          id="abort-link"
          >[ RESET CONNECTION ]</a
        >
      </div>
    </div>

    <script src="dither.js"></script>
    <script src="hints.js"></script>
    <script src="audio.js"></script>
    <script>
      startLivingWired();
      document.addEventListener(
        'click',
        () => {
          if (window.audioCtx && audioCtx.state === 'suspended')
            audioCtx.resume();
          initAudio();
        },
        { once: true }
      );
      registerHint('chat-input', 'glitch-hint');
      registerHint('abort-link', 'cursor-hint');

      const chatBox = document.getElementById('chat-box');
      const input = document.getElementById('chat-input');
      0;

      const responses = [
        'ACCESS DENIED.',
        'INCORRECT.',
        'WHO ARE YOU?',
        'THE DATA DOES NOT MATCH.',
        'YOU ARE NOT AUTHORIZED.',
        '...',
      ];

      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const txt = input.value.trim().toUpperCase();
          addMsg('YOU', txt, 'user');
          input.value = '';

          // PUZZLE LOGIC
          if (txt.includes('GHOST') && txt.includes('1998')) {
            setTimeout(() => {
              addMsg('SYSTEM', 'AUTHENTICATION VERIFIED.', 'sys');
              addMsg('SYSTEM', 'UNLOCKING CORE...', 'sys');
              document.body.classList.add('chaos-mode');
              playScreech(); // From audio.js
              setTimeout(() => {
                window.location.href = 'layer_07.html';
              }, 3000);
            }, 1000);
          } else {
            // Failure response
            setTimeout(() => {
              const resp =
                responses[Math.floor(Math.random() * responses.length)];
              addMsg('ALICE', resp, 'other');
              // Punish with glitch
              document.body.classList.toggle('invert-flash');
              setTimeout(
                () => document.body.classList.remove('invert-flash'),
                500
              );
            }, 500 + Math.random() * 1000);
          }
        }
      });

      function addMsg(user, txt, cls) {
        const div = document.createElement('div');
        div.className = 'msg ' + cls;
        div.innerText = `[${user}]: ${txt}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    </script>
  </body>
</html>
